'use strict';

var request = require('request');

var getBusTimesAll = function getBusTimesAll(stopId, callback) {
    var url = 'https://data.dublinked.ie/cgi-bin/rtpi/realtimebusinformation?stopid=' + stopId + '&format=json';

    request(url, function (error, response, body) {
        if (!error && response.statusCode == 200) {
            var returnedData = JSON.parse(body);
            var resultCount = Object.keys(returnedData.results).length;
            if(resultCount > 0)
            {
                for(var i = 0; i < resultCount; i++)
                {
                    var duetime = returnedData.results[i].duetime;
                    var route = returnedData.results[i].route;
                    var reply = 'There is a ' + route + ' in ' + duetime + ' minutes.';
                    callback(error, reply);
                }
            }
            else
            {
                var reply = 'There are no bus times for this stop currently.';
                callback(error, reply);
            }
        } else {
            callback(error);
        }
    });
};

module.exports = getBusTimesAll;